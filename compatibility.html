<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Compatibility
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A .NET library that provides the full set of financial functions from Excel.">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/ExcelFinancialFunctions/content/style.css" />
    <script type="text/javascript" src="/ExcelFinancialFunctions/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/fsprojects/ExcelFinancialFunctions">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/ExcelFinancialFunctions/index.html">ExcelFinancialFunctions</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Compatibility" class="anchor" href="#Compatibility">Compatibility</a></h1>
<p>This library replicates Excel behavior. There're 199,252 tests verifying the results against Excel 2010 and their number can be raised significantly by adding new test values. Several tests check the function properties, e.g. that bond duration can't be greater than maturity.<br />
The current version matches Excel 2010, which is slightly different from 2003, see <a href="http://blogs.office.com/b/microsoft-excel/archive/2009/09/10/function-improvements-in-excel-2010.aspx">Function Improvements in Excel 2010</a>.
Note, that console tests require Excel, whereas the unit tests can be run even on mono - their parameters and expected results are stored in files.</p>
<p>However, there're still some differences comparing to Excel.
<em>Read more about OpenOffice vs Excel <a href="openofficediff.html">here</a>.</em></p>
<h2><a name="COUPDAYS" class="anchor" href="#COUPDAYS">COUPDAYS</a></h2>
<p>The Excel algorithm doesn't respect equality <code>coupDays = coupDaysBS + coupDaysNC</code>. The library result differs from Excel by +/- one or two days when the date spans a leap year. (<a href="http://office.microsoft.com/en-us/excel/HP052090311033.aspx">office docs</a>)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">settlement</span> <span class="o">=</span> <span class="i">DateTime</span>(<span class="n">2012</span>, <span class="n">1</span>, <span class="n">1</span>)
<span class="k">let</span> <span class="i">maturity</span>   <span class="o">=</span> <span class="i">DateTime</span>(<span class="n">2016</span>, <span class="n">2</span>, <span class="n">29</span>)

<span class="k">let</span> <span class="i">param</span> <span class="o">=</span> <span class="i">settlement</span>, <span class="i">maturity</span>, <span class="i">Frequency</span><span class="o">.</span><span class="i">SemiAnnual</span>, <span class="i">DayCountBasis</span><span class="o">.</span><span class="i">ActualActual</span>

<span class="k">let</span> <span class="i">days</span> <span class="o">=</span> <span class="i">Financial</span><span class="o">.</span><span class="i">CoupDays</span> <span class="i">param</span>
<span class="k">let</span> <span class="i">bs</span> <span class="o">=</span> <span class="i">Financial</span><span class="o">.</span><span class="i">CoupDaysBS</span> <span class="i">param</span>
<span class="k">let</span> <span class="i">nc</span> <span class="o">=</span> <span class="i">Financial</span><span class="o">.</span><span class="i">CoupDaysNC</span> <span class="i">param</span>
<span class="c">// Excel: 2</span>
<span class="i">days</span> <span class="o">-</span> <span class="i">bs</span> <span class="o">-</span> <span class="i">nc</span>
<span class="fsi">val days : float = 182.0</span>
<span class="fsi">val bs : float = 123.0</span>
<span class="fsi">val nc : float = 59.0</span>
<span class="fsi">val it : float = 0.0</span>
</code></pre></td>
</tr>
</table>
<h2><a name="VDB" class="anchor" href="#VDB">VDB</a></h2>
<p>In the Excel version of this algorithm the depreciation in the period (0,1) is not the same as the sum of the depreciations in periods (0,0.5) (0.5,1)<br />
Notice that in Excel by using '1' (no_switch) instead of '0' as the last parameter everything works as expected.<br />
In truth, the last parameter should have no influence in the calculation given that in the first period there is no switch to sln depreciation.<br />
Overall, the algorithm is correct, even if it disagrees with Excel when startperiod is fractional. (<a href="http://office.microsoft.com/en-us/excel/HP052093341033.aspx">office docs</a>)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">vdb</span> <span class="i">sp</span> <span class="i">ep</span> <span class="i">switch</span> <span class="o">=</span> 
    <span class="i">Financial</span><span class="o">.</span><span class="i">Vdb</span>(<span class="n">100.0</span>, <span class="n">10.0</span>, <span class="n">13.0</span>, <span class="i">sp</span>, <span class="i">ep</span>, <span class="n">1.0</span>, 
        <span class="k">if</span> <span class="i">switch</span> <span class="k">then</span> <span class="i">VdbSwitch</span><span class="o">.</span><span class="i">SwitchToStraightLine</span> <span class="k">else</span> <span class="i">VdbSwitch</span><span class="o">.</span><span class="i">DontSwitchToStraightLine</span>)

<span class="k">let</span> <span class="i">p1</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.0</span> <span class="n">0.5</span> <span class="k">false</span>
<span class="k">let</span> <span class="i">p2</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.5</span> <span class="n">1.0</span> <span class="k">false</span>
<span class="k">let</span> <span class="i">total</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.0</span> <span class="n">1.0</span> <span class="k">false</span>
<span class="c">// Excel: 0.1479</span>
<span class="i">total</span> <span class="o">-</span> <span class="i">p1</span> <span class="o">-</span> <span class="i">p2</span> 
<span class="fsi">val p1 : float = 3.846153846</span>
<span class="fsi">val p2 : float = 3.846153846</span>
<span class="fsi">val total : float = 7.692307692</span>
<span class="fsi">val it : float = 0.0</span>

<span class="k">let</span> <span class="i">p1sw</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.0</span> <span class="n">0.5</span> <span class="k">true</span>
<span class="k">let</span> <span class="i">p2sw</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.5</span> <span class="n">1.0</span> <span class="k">true</span>
<span class="k">let</span> <span class="i">totalsw</span> <span class="o">=</span> <span class="i">vdb</span> <span class="n">0.0</span> <span class="n">1.0</span> <span class="k">true</span>
<span class="c">// Excel: 0.0000</span>
<span class="i">totalsw</span> <span class="o">-</span> <span class="i">p1sw</span> <span class="o">-</span> <span class="i">p2sw</span> 
<span class="fsi">val p1sw : float = 3.846153846</span>
<span class="fsi">val p2sw : float = 3.846153846</span>
<span class="fsi">val totalsw : float = 7.692307692</span>
<span class="fsi">val it : float = 0.0</span>
</code></pre></td>
</tr>
</table>
<h2><a name="AMORDEGRC" class="anchor" href="#AMORDEGRC">AMORDEGRC</a></h2>
<p>ExcelCompliant is used because Excel stores 13 digits. AmorDegrc algorithm rounds numbers<br />
and returns different results unless the numbers get rounded to 13 digits before rounding them.<br />
I.E. 22.49999999999999 is considered 22.5 by Excel, but 22.4 by the .NET framework. (<a href="http://office.microsoft.com/en-us/excel/HP052089841033.aspx">office docs</a>)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">amorDegrc</span> <span class="i">excelCompliant</span> <span class="o">=</span> 
    <span class="i">Financial</span><span class="o">.</span><span class="i">AmorDegrc</span>(<span class="n">100.0</span>, <span class="i">DateTime</span>(<span class="n">2014</span>,<span class="n">1</span>,<span class="n">1</span>), <span class="i">DateTime</span>(<span class="n">2016</span>,<span class="n">1</span>,<span class="n">1</span>), 
        <span class="n">50.0</span>, <span class="n">1.0</span>, <span class="n">0.3</span>, <span class="i">DayCountBasis</span><span class="o">.</span><span class="i">ActualActual</span>, <span class="i">excelCompliant</span>)

<span class="i">amorDegrc</span> <span class="k">true</span>
<span class="fsi">val it : float = 23.0</span>
<span class="i">amorDegrc</span> <span class="k">false</span>
<span class="fsi">val it : float = 22.0</span>
</code></pre></td>
</tr>
</table>
<h2><a name="DDB" class="anchor" href="#DDB">DDB</a></h2>
<p>Excel Ddb has two interesting characteristics:<br />
1. It special cases ddb for fractional periods between 0 and 1 by considering them to be 1<br />
2. It is inconsistent with VDB(..., True) for fractional periods, even if VDB(..., True) is defined to be the same as ddb. The algorithm for VDB is theoretically correct.<br />
This function makes the same 1. adjustment.(<a href="http://office.microsoft.com/en-us/excel/HP052090511033.aspx">office docs</a>)</p>
<h2><a name="RATE-and-ODDFYIELD" class="anchor" href="#RATE-and-ODDFYIELD">RATE and ODDFYIELD</a></h2>
<p>Excel uses a different root finding algo. Sometimes the library results are better, sometimes Excel's. (<a href="http://office.microsoft.com/en-us/excel/HP052092321033.aspx">office docs</a>)</p>
<h2><a name="XIRR-and-XNPV" class="anchor" href="#XIRR-and-XNPV">XIRR and XNPV</a></h2>
<p>XIRR and XNPV functions are related: the net present value, given the internal rate of return, should be zero.
However, XNPV works only for positive rates even though the XIRR results might be negative.
The results can also be different because of the root finding functions. (<a href="http://office.microsoft.com/en-us/excel/HP052093411033.aspx">office docs</a>)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">dates</span> <span class="o">=</span> [|<span class="i">DateTime</span>(<span class="n">2000</span>, <span class="n">2</span>, <span class="n">29</span>); <span class="i">DateTime</span>(<span class="n">2000</span>, <span class="n">3</span>, <span class="n">31</span>)|]
<span class="k">let</span> <span class="i">values</span> <span class="o">=</span> [|<span class="n">206101714.849377</span>; <span class="o">-</span><span class="n">156650972.54265</span>|]
<span class="c">// Excel: -0.960452189</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XIrr</span>(<span class="i">values</span>, <span class="i">dates</span>, <span class="o">-</span><span class="n">0.1</span>)
<span class="fsi">val it : float = -0.960452195</span>
<span class="c">// Excel: #NUM!</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XNpv</span>(<span class="o">-</span><span class="n">0.960452195</span>, <span class="i">values</span>, <span class="i">dates</span>)
<span class="fsi">val it : float = -0.008917063475</span>
<span class="c">// Excel: #NUM!</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XNpv</span>(<span class="o">-</span><span class="n">0.960452189</span>, <span class="i">values</span>, <span class="i">dates</span>)
<span class="fsi">val it : float = 2.646784514</span>

<span class="k">let</span> <span class="i">values2</span> <span class="o">=</span> [|<span class="n">15108163.3840923</span>; <span class="o">-</span><span class="n">75382259.6628424</span>|]
<span class="c">// Excel: #NUM!</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XIrr</span>(<span class="i">values2</span>, <span class="i">dates</span>, <span class="o">-</span><span class="n">0.1</span>)
<span class="fsi">val it : float = 165601346.1</span>
<span class="c">// Excel: 165601345.6</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XIrr</span>(<span class="i">values2</span>, <span class="i">dates</span>, <span class="n">0.1</span>)
<span class="fsi">val it : float = 165601346.1</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XNpv</span>(<span class="n">165601346.1</span>, <span class="i">values2</span>, <span class="i">dates</span>)
<span class="fsi">val it : float = -0.000269997865</span>
<span class="i">Financial</span><span class="o">.</span><span class="i">XNpv</span>(<span class="n">165601345.6</span>, <span class="i">values2</span>, <span class="i">dates</span>)
<span class="fsi">val it : float = -0.004144238308</span>
</code></pre></td>
</tr>
</table>


        </div>
        <div class="span3">
	  <a href="https://nuget.org/packages/ExcelFinancialFunctions">
            <img src="/ExcelFinancialFunctions/img/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">ExcelFinancialFunctions</li>
            <li><a href="/ExcelFinancialFunctions/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/ExcelFinancialFunctions">Get Library via NuGet</a></li>
            <li><a href="http://github.com/fsprojects/ExcelFinancialFunctions">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsprojects/ExcelFinancialFunctions/blob/master/LICENSE.txt">License</a></li>
            <li><a href="http://github.com/fsprojects/ExcelFinancialFunctions/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
            <li class="nav-header">Documentation</li>
            <li><a href="/ExcelFinancialFunctions/reference/index.html">API Reference</a></li>
            <li><a href="/ExcelFinancialFunctions/compatibility.html">Excel Compatibility</a></li>
            <li><a href="/ExcelFinancialFunctions/openofficediff.html">OpenOffice Differences</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsprojects/ExcelFinancialFunctions"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>
  </body>
  </html>
